我们在vlan trunk中，对同一交换机进行vlan划分，不同vlan的主机不可以通信，相同vlan的主机才可以通信，相同VLAN也是可以跨交换机的（两个交换机采用相同的vlan）

如果想要不同vlan的主机可以通信，该怎么做？

不同vlan，是属于不同广播域，配置的是不同的网段IP，针对于不同网段IP进行通信，需要借助路由

可以实现不同vlan间的通信技术：单臂路由，三层交换

# ==单臂路由==

**实现不同vlan间的通信**

![image-20230722131816347](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230722131816347.png)

- 在路由器上划分子接口，作为不同vlan的网关，每一个子接口作为一个vlan的网关，**需要做vlan的封装**（否则无法识别）
- 交换机与主机连接的链路：access
- 交换机与路由器连接的链路：trunk



工作原理：

![image-20230722132828915](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230722132828915.png)

以上图为例，PC0需要发送数据给PC1，发现PC1和自己属于不同网段，这是将数据提交给自己的网关，网关为路由器0的F0/0.1子接口，通过ARP协议PC0获取到自己网关的MAC地址，数据会通过交换机进行转发，到了交换机后，会为收到的数据打上vlan10的标签，将数据传到路由器0，路由器0接收到数据，结合路由器的工作原理，查看目的IP地址，找到对应接口，再进行标签转换，再发送到交换机，这时交换机收到的数据就是vlan20的数据，根据交换机的MAC地址表的对应关系进行转发



接下来我们在Cisco上做实验

配置如下所示：

![image-20230722144215765](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230722144215765.png)

- 交换机配置

  ```shell
  en
  conf t
  vlan 10
  vlan 20
  exit
  int f0/1
  sw acc vlan 10
  int f0/2
  sw acc vlan 20
  int f0/3
  sw mo trunk
  ```

- 路由器配置

  ```shell
  en
  conf t
  int g0/0.1
  encapsulation dot1Q 10    #进入g0/0.1接口并配置									vlan封装结构
  ip add 192.168.10.254 255.255.255.0
  exit
  int g0/0.2
  encapsulation dot1Q 20    #进入g0/0.2接口并配置									vlan封装结构
  ip add 192.168.20.254 255.255.255.0
  exit
  int g0/0
  no shut
  exit
  ip dhcp pool vlan10     #创建dhcp地址池
  network 192.168.10.0 255.255.255.0    #规划拿来给								  主机分配的网段
  defaultt-router 192.168.10.254    #设置默认网关
  exit
  ip dhcp pool vlan20
  neteork 192.168.20.0 255.255.255.0
  default-router 192.168.20.254
  exit
  end
  ```

一切完成后进行ping操作