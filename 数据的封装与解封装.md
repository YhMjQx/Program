# 数据的封装与解封装

## 目标

1.理解数据的封装和解封装的过程

2.针对于一个简单的网络环境能够独立讲解出网络的传输过程

**下面的表格和图片基本上都是各个层的功能**

| 主机一，发送一个文本文件，即：主机一发送数据（从应用层到物理层） | 主机二，接收主机一发送的数据，即：主机二接收数据（从物理层到应用层） | PDU（协议传输数据单元） | **实现功能所需主要设备** |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------------- | ------------------------------------------------------------ |
| **应用层：将原始数据转化为计算机识别的二进制数**             | **应用层：将二进制数转换为原始数据**                         | **原始数据**            | 计算机 |
| **传输层：再传输层，是由固定传输数据单元（PDU）来决定是否将数据分成小段，在每个小段的前面封装TCP头部，有一个关键字段 - 端口号，他是用来标识上层数据是用什么协议或程序来进行传输的** | **传输层：查看目的端口号**                                   | **数据段**              | 防火墙 |
| **网络层：进行逻辑地址寻址，进行IP头部的封装，主要的字段 - 源IP和目的IP** | **网络层：查看目的IP地址**                                   | **数据包**              | 路由器 |
| **数据链路层：建立逻辑连接，进行物理地址寻址，主要的字段 - 源mac和目的mac，当访问不同的网络时，目的mac是自己网关的mac地址，因为要访问不同的网络的时候，请求需要离开自己的网络抵达目的网络，因此就必须离开自己的网关，离开之后，请求就会依托于中间设备（路由器，交换机...）来传递** | **数据链路层：将数据链路层的数据拆开，查看目的mac地址是否是自己的，如果是继续解封装** | **数据帧**              | 二层交换机 |
| **物理层：将二进制数据转换为电信号通过网卡再通过网线传输出去** | **物理层：将电信号转化为二进制数据**                         | **比特流**              | 网卡 |

这些设备也不一定就固定在所说的这些工作层，现在大多数的中间设备一般都工作在多层，比如带有路由功能的交换机，带有防火墙的路由器等等

![image-20230630160322875](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230630160322875.png)

**数据的传输过程：**

![image-20230701164547891](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230701164547891.png)

主机A现在要给主机B发送数据，发现处于不同网络中，于是要进行数据封装

**传输层**：封装对应端口号 	**网络层**：源IP是主机A的IP地址，目的IP是主机B的IP 	**数据链路层**：源MAC地址是主机A的mac，目的MAC是与主机A直接相连的路由器的MAC地址

接着继续进行数据传输，在传输过程中，遇到了二层交换机，二层交换机是属于数据链路层的设备，所以交换机将数据解封装到数据链路层

根据交换机的工作原理：交换机中维护了一张MAC地址表，首先查看源MAC地址，如果不在自己表中，进行学习并记录，再查看目的MAC地址，如果在自己表中，找到对应的接口，直接将原始数据进行封装转发，但如果不在表中，就利用广播的形式

接着进行数据传输，传输过程中遇到了路由器，解封到数据链路层之后，查看目的MAC地址，如果是就继续解封到网络层，网络层查看目标IP地址，根据路由表可知，目标IP地址是否可达，如果可达，重新进行二层封装，然后找到对应的接口转发（意思是只需要对数据链路层的数据进行封装，不需要对网络层的数据进行封装，如果可以传输，网络层的数据是可以直接传输的，如果不可以传输，那么就会直接退还给上一个路由器）
